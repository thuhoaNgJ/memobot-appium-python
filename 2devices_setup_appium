from appium import webdriver
from appium.options.android import UiAutomator2Options
import time

def setup_driver(device_name, system_port, server_url):
    options = UiAutomator2Options()
    options.set_capability("platformName", "Android")
    options.set_capability("automationName", "UiAutomator2")
    options.set_capability("deviceName", device_name)
    options.set_capability("appPackage", "vn.vais.memobot")
    options.set_capability("appActivity", "com.ryanheise.audioservice.AudioServiceActivity")
    # Quan tr·ªçng: systemPort kh√°c nhau cho m·ªói device
    options.set_capability("systemPort", system_port)

    driver = webdriver.Remote(server_url, options=options)
    time.sleep(5)
    print(f"‚úÖ M·ªü app th√†nh c√¥ng tr√™n thi·∫øt b·ªã {device_name}")
    return driver


if __name__ == "__main__":
    # Device 1 (c·ªïng 4723)
    driver1 = setup_driver("47c92427", 8200, "http://127.0.0.1:4723/wd/hub")

    # Device 2 (c·ªïng 4725)
    driver2 = setup_driver("AHB00009462", 8201, "http://127.0.0.1:4725/wd/hub")

    # Test nh·ªè: in ra activity hi·ªán t·∫°i
    print("üì± Device 1 ƒëang ·ªü:", driver1.current_activity)
    print("üì± Device 2 ƒëang ·ªü:", driver2.current_activity)

    # Gi·ªØ app m·ªü 10s r·ªìi quit
    time.sleep(10)
